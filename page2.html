<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { background-color: black; color: white; font-family: 'Helvetica', Arial, sans-serif; padding: 20px; text-align: left; }
        .header { font-size: 1.8em; font-weight: bold; margin-bottom: 30px; }
        .container { display: flex; gap: 40px; align-items: flex-start; }
        .day-column { display: flex; flex-direction: column; align-items: flex-start; width: 120px; }
        .label { font-size: 1.2em; margin-bottom: 10px; color: white; }
        
        /* The Map Icon */
        .map-svg { width: 80px; height: auto; margin-bottom: 15px; filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.5)); }
        .region-shape { stroke: #333; stroke-width: 0.5; transition: fill 0.3s ease; }
        .inner-lines { fill: none; stroke: rgba(0,0,0,0.2); stroke-width: 0.5; }

        .rating { font-size: 1.1em; font-weight: bold; letter-spacing: 0.5px; }
        
        /* CFA Colors */
        .MODERATE { fill: #78be20; color: #78be20; } 
        .HIGH { fill: #ffb81c; color: #ffb81c; } 
        .EXTREME { fill: #e03c31; color: #e03c31; } 
        .CATASTROPHIC { fill: #000; color: #e03c31; stroke: white; stroke-width: 0.5; }
    </style>
</head>
<body>
    <div class="header">Fire Danger Ratings</div>
    <div id="content" class="container">Loading live CFA data...</div>

    <script>
        // Custom SVG shape for the South West region
        const mapTemplate = (colorClass) => `
            <svg class="map-svg" viewBox="0 0 100 75" xmlns="http://www.w3.org/2000/svg">
                <path class="region-shape ${colorClass}" d="M10,40 L15,35 L30,35 L40,25 L65,25 L75,15 L85,15 L85,45 L95,45 L95,65 L80,70 L40,70 L25,60 L10,55 Z" />
                <path class="inner-lines" d="M40,25 L40,70 M65,25 L65,55 M75,15 L75,45 M15,35 L40,45" />
            </svg>`;

        async function fetchFeed() {
            const rssUrl = "https://www.cfa.vic.gov.au/cfa/rssfeed/southwest-firedistrict_rss.xml";
            const proxy = "https://corsproxy.io/?" + encodeURIComponent(rssUrl);
            
            try {
                const response = await fetch(proxy);
                const text = await response.text();
                const parser = new DOMParser();
                const xml = parser.parseFromString(text, "text/xml");
                const items = xml.querySelectorAll("item");
                
                let html = '';
                const labels = ["Today", "Tomorrow", "Overmorrow"];
                
                for (let i = 0; i < 3; i++) {
                    const desc = items[i].querySelector("description").textContent.toUpperCase();
                    
                    let colorClass = "HIGH";
                    let ratingText = "HIGH";

                    if (desc.includes("CATASTROPHIC")) { colorClass = "CATASTROPHIC"; ratingText = "CATASTROPHIC"; }
                    else if (desc.includes("EXTREME")) { colorClass = "EXTREME"; ratingText = "EXTREME"; }
                    else if (desc.includes("MODERATE") || desc.includes("NO RATING")) { colorClass = "MODERATE"; ratingText = "MODERATE"; }
                    else { colorClass = "HIGH"; ratingText = "HIGH"; }

                    html += `
                        <div class="day-column">
                            <div class="label">${labels[i]}</div>
                            ${mapTemplate(colorClass)}
                            <div class="rating ${colorClass}">${ratingText}</div>
                        </div>`;
                }
                document.getElementById('content').innerHTML = html;
            } catch (err) {
                document.getElementById('content').innerHTML = "Unable to reach CFA data.";
            }
        }

        fetchFeed();
        setInterval(fetchFeed, 1800000);
    </script>
</body>
</html>
