async function fetchFeed() {
    const rssUrl = "https://www.cfa.vic.gov.au/cfa/rssfeed/southwest-firedistrict_rss.xml";
    const proxy = "https://corsproxy.io/?" + encodeURIComponent(rssUrl);
    
    try {
        const response = await fetch(proxy);
        if (!response.ok) throw new Error('Network response was not ok');
        const text = await response.text();
        const parser = new DOMParser();
        const xml = parser.parseFromString(text, "text/xml");
        const items = xml.querySelectorAll("item");
        
        let html = '';
        const labels = ["Today", "Tomorrow", "Overmorrow"];
        
        for (let i = 0; i < 3; i++) {
            const description = items[i].querySelector("description").textContent;
            const ratingText = description.trim().toUpperCase();
            
            // Check if Total Fire Ban is mentioned
            const isTFB = ratingText.includes("TOTAL FIRE BAN") || ratingText.includes("TFB");

            let colorClass = "HIGH";
            if (ratingText.includes("EXTREME")) colorClass = "EXTREME";
            if (ratingText.includes("MODERATE")) colorClass = "MODERATE";
            if (ratingText.includes("CATASTROPHIC")) colorClass = "CATASTROPHIC";
            if (ratingText.includes("NO RATING")) colorClass = "MODERATE";

            html += `
                <div class="day-column">
                    <div class="label">${labels[i]}</div>
                    <div class="map-box bg-${colorClass}">
                        SOUTH WEST
                    </div>
                    <div class="rating ${colorClass}">${ratingText}</div>
                    ${isTFB ? `
                        <div style="margin-top:20px;">
                            <img src="https://www.cfa.vic.gov.au/cdn-cgi/image/width=150,f=auto/assets/images/total-fire-ban-logo.png" 
                                 alt="Total Fire Ban in Force" 
                                 style="width:120px; height:auto; border: 2px solid white; border-radius: 50%;">
                            <div style="color:red; font-weight:bold; margin-top:5px;">FIRE BAN IN FORCE</div>
                        </div>` : ''}
                </div>`;
        }
        document.getElementById('content').innerHTML = html;
    } catch (err) {
        console.error(err);
        document.getElementById('content').innerHTML = "Unable to reach CFA. Check connection or try refreshing.";
    }
}

fetchFeed();
setInterval(fetchFeed, 1800000);
