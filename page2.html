<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>South West Fire Danger Dashboard</title>
    <style>
        body { 
            background-color: black; 
            color: white; 
            font-family: 'Segoe UI', Arial, sans-serif; 
            padding: 40px; 
            text-align: center; 
        }
        .header { 
            font-size: 2.5em; 
            font-weight: bold; 
            margin-bottom: 50px; 
            border-bottom: 2px solid #333; 
            padding-bottom: 10px; 
        }
        .container { 
            display: flex; 
            justify-content: center; 
            gap: 60px; 
            flex-wrap: wrap;
        }
        .day-column { 
            flex: 1; 
            max-width: 280px; 
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .label { 
            font-size: 1.8em; 
            margin-bottom: 20px; 
            color: #ccc; 
            font-weight: bold;
        }
        
        /* Map Styling */
        .district-map {
            width: 200px;
            height: auto;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.1));
            transition: fill 0.5s ease;
        }

        .rating { 
            font-size: 2em; 
            font-weight: 900; 
            letter-spacing: 1px; 
            text-transform: uppercase; 
        }
        
        /* CFA Rating Colors */
        .MODERATE { fill: #78be20; color: #78be20; } 
        .HIGH { fill: #ffb81c; color: #ffb81c; } 
        .EXTREME { fill: #e03c31; color: #e03c31; } 
        .CATASTROPHIC { fill: #000; color: #fb4f4f; stroke: #fb4f4f; stroke-width: 2px; }
        .NO-RATING { fill: #333; color: #666; }
    </style>
</head>
<body>

    <div class="header">South West Fire Danger</div>
    <div id="content" class="container">Loading live CFA data...</div>

    <script>
        // This function returns an SVG path representing the South West District silhouette
        function getMapSVG(colorClass) {
            return `
            <svg class="district-map ${colorClass}" viewBox="0 0 250 180" xmlns="http://www.w3.org/2000/svg">
                <path d="M20,60 L60,20 L180,30 L230,80 L210,140 L150,160 L60,155 L20,110 Z" 
                      stroke="white" stroke-width="2" />
                <text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" 
                      fill="black" font-size="16" font-weight="bold" font-family="Arial">
                    SOUTH WEST
                </text>
            </svg>`;
        }

        async function fetchFeed() {
            const rssUrl = "https://www.cfa.vic.gov.au/cfa/rssfeed/southwest-firedistrict_rss.xml";
            const proxy = "https://corsproxy.io/?" + encodeURIComponent(rssUrl);
            
            try {
                const response = await fetch(proxy);
                if (!response.ok) throw new Error('Network response error');
                const text = await response.text();
                const parser = new DOMParser();
                const xml = parser.parseFromString(text, "text/xml");
                const items = xml.querySelectorAll("item");
                
                let html = '';
                const labels = ["Today", "Tomorrow", "Overmorrow"];
                
                for (let i = 0; i < 3; i++) {
                    const ratingRaw = items[i].querySelector("description").textContent.trim().toUpperCase();
                    
                    // Simple logic to determine color class
                    let colorClass = "HIGH";
                    if (ratingRaw.includes("EXTREME")) colorClass = "EXTREME";
                    else if (ratingRaw.includes("MODERATE")) colorClass = "MODERATE";
                    else if (ratingRaw.includes("CATASTROPHIC")) colorClass = "CATASTROPHIC";
                    else if (ratingRaw.includes("NO RATING")) colorClass = "NO-RATING";

                    // Clean up the text for display (remove "SOUTH WEST:" prefix if present)
                    const cleanRating = ratingRaw.replace("SOUTH WEST:", "").trim();

                    html += `
                        <div class="day-column">
                            <div class="label">${labels[i]}</div>
                            ${getMapSVG(colorClass)}
                            <div class="rating ${colorClass}">${cleanRating}</div>
                        </div>`;
                }
                document.getElementById('content').innerHTML = html;
            } catch (err) {
                console.error(err);
                document.getElementById('content').innerHTML = "Unable to reach CFA data.";
            }
        }

        fetchFeed();
        setInterval(fetchFeed, 1800000); // Auto-refresh every 30 mins
    </script>
</body>
</html>
